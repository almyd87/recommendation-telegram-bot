
@bot.message_handler(content_types=['photo'])
def handle_payment_image(message):
    user_id = str(message.from_user.id)
    if user_id == str(ADMIN_ID) and SESSIONS.get(message.from_user.id, {}).get("change_image"):
        file_info = bot.get_file(message.photo[-1].file_id)
        downloaded_file = bot.download_file(file_info.file_path)
        with open(SUBSCRIPTION_IMAGE, 'wb') as f:
            f.write(downloaded_file)
        bot.send_message(message.chat.id, "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.")
        del SESSIONS[message.from_user.id]
        return

@bot.message_handler(func=lambda m: m.text == "ğŸ–¼ï¸ ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ")
def change_image_request(message):
    if message.from_user.id != ADMIN_ID:
        return
    bot.send_message(message.chat.id, "ğŸ“¥ Ø£Ø±Ø³Ù„ Ø§Ù„Ø¢Ù† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:")
    SESSIONS[message.from_user.id] = {"change_image": True}

def send_subscription_info(user_id):
    config = load_config()
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("ØªÙ… Ø§Ù„Ø¯ÙØ¹ØŒ Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø«Ø¨Ø§Øª", callback_data="wait_proof"))
    text = f"""Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:
Ø§Ù„Ø³Ø¹Ø±: {config['price']}
Ø§Ù„Ù…Ø­ÙØ¸Ø©: {config['wallet']}

ğŸ“¸ Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø«Ø¨Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹."""
    bot.send_message(user_id, text, reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "wait_proof")
def ask_for_proof(call):
    bot.send_message(call.message.chat.id, "Ø§Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø«Ø¨Ø§Øª:")
    bot.register_next_step_handler(call.message, receive_proof)

def receive_proof(message):
    if not message.photo:
        bot.send_message(message.chat.id, "Ø§Ø±Ø³Ù„ ØµÙˆØ±Ø© ÙÙ‚Ø·.")
        return
    user_id = str(message.from_user.id)
    file_id = message.photo[-1].file_id
    file_info = bot.get_file(file_id)
    downloaded_file = bot.download_file(file_info.file_path)
    proof_path = os.path.join("pending", f"{user_id}.jpg")
    with open(proof_path, "wb") as f:
        f.write(downloaded_file)
    users = load_users()
    info = users.get(user_id, {})
    caption = f"Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:
Ø§Ù„Ø§Ø³Ù…: {info.get('name', 'Ù…Ø¬Ù‡ÙˆÙ„')}
Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„: {info.get('email', 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ')}
Ø§Ù„Ù…Ø¹Ø±Ù: {user_id}"
    bot.send_message(ADMIN_ID, caption)
    bot.send_photo(ADMIN_ID, photo=open(proof_path, 'rb'), caption="Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø·Ù„Ø¨")
